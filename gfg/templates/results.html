<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8">

      <title>NOVA IMS - Group Project Seminar Proposal</title>

      <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
      crossorigin=""/>

      <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
      integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
      crossorigin=""></script>


      <style>
        #top {
			width: 100%;
			height: 30px;
			float:top;
            font: 20px Arial, Helvetica, sans-serif;
            color: #524f4f;
		}
        
        #map {
			width: 55%;
			height: 550px;
			float:left;
		}
    
        #form {
			width: 42%;
			height: 500px;
			float:right;
            font: 15px Arial, Helvetica, sans-serif;
            color: #524f4f;
		    }

      </style>
  </head>
  <body>
    <div id="top">
        <p style = "text-align:center;"><b>NOVA IMS - Group Project Seminar Proposal: Mapping Oceanic Hazards</b></p>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>

    <script type="text/javascript">

        //styles bottom type
        var geojsonMarkerOptions = {
        radius: 8,
        fillColor: "#7FFFD4",
        color: "#7FFFD4",
        weight: 1,
        opacity: 1,
        fillOpacity: 0.8
        };
        
        //styles shark attacks 
        var geojsonMarkerOptions_shark = {
        radius: 8,
        fillColor: "#008080",
        color: "#008080",
        weight: 1,
        opacity: 1,
        fillOpacity: 0.4
        };

        //create the leaflet.js map, centered (x,y) values that comes from flask
        var map = L.map('map').setView([{{y|safe}}, {{x|safe}}], 11);

        //create the variables of the geojson that come from flask
        var bottom_type =  {{bottom_type|safe}};
        var shark_attacks =  {{shark_attacks|safe}};
        var coral_reefs =  {{coral_reefs|safe}};
        var hazard_areas =  {{hazard_areas|safe}};
        
        var basemap = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);


        //return each feature on the map and display popups
        var bottom_layer = L.geoJSON(bottom_type, {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, geojsonMarkerOptions);
            },
            onEachFeature: function (feature, layer){
                layer.bindPopup('<p><b> Bottom type: '+ feature.properties.seabed)
            }
        }).addTo(map);

        var coral_layer = L.geoJSON(coral_reefs,{
            onEachFeature: function (feature, layer) {
                layer.bindPopup('<p><b> Area in acres: '+ feature.properties.acres +  '</b></p>')
            },
            style: {
                    color: "orange",
                    weight: 2,
                    fillColor: "orange",
                    fillOpacity: 0.4
                }
        }).addTo(map);

        var hazard_layer = L.geoJSON(hazard_areas,{
            onEachFeature: function (feature, layer) {
                layer.bindPopup('<p><b> Depth in meters: '+ feature.properties.gridcode + '</b></p>')
            },
            style: {
                    color: "red",
                    weight: 2, 
                    fillColor: "red",
                    fillOpacity: 0.4
                }
        }).addTo(map);

        var shark_layer = L.geoJSON(shark_attacks, {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, geojsonMarkerOptions_shark);
            },
            onEachFeature: function (feature, layer){
                layer.bindPopup('<p><b> Attack date:' + feature.properties.Date + '</b></p>' + '<p><b> Attack location:' + feature.properties.Location_attack + feature.properties.Location_attack2, feature.properties.full_location, '<p><b> Shark type:' + feature.properties.Shark)
            }
        }).addTo(map);

        //adding layers control panel 

        var baselayers = {"Basemap": basemap};  
        var overlays = {
            "Bottom Type" : bottom_layer,
            "Coral Reefs" : coral_layer,
            "Ocean Depth": hazard_layer
            //"Shark Attacks": shark_layer
        };
    
        L.control.layers(baselayers).addTo(map)
        //overlays, {collapsed: "false"}); //.addTo(map);
        //layerControl.addTo(map);

        //pass coordinates to the form when click on the map
        map.on('click', function(e) {
        var lat = e.latlng.lat;
        var lon = e.latlng.lng;
        document.getElementById('longitude').value = lon;
        document.getElementById('latitude').value = lat;
        });
        
    </script>

    <div id = form>
        <form action="{{ url_for("gfg")}}" method="post">
            <label for="longitude">Longitude (x):</label>
            <input type="text" id="longitude" name="lon" placeholder="longitude">
            <label for="latitude">Latitude (y):</label>
            <input type="text" id="latitude" name="lat" placeholder="latitude">
            <button type="submit">Submit</button>
        </form>
    </div>
    
  </body>

</html>